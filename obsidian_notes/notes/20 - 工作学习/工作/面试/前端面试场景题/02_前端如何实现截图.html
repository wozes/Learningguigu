<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>前端如何实现截图</title>
        <!-- 使用canvas及其相关API -->
    <style>
      #canvas {
        position: fixed;
        left: 0;
        top: 0;
        z-index: -1; /* 隐藏canvas避免遮挡 */
        pointer-events: none; /* 禁止交互 */
      }
      #download {
        margin-left: 10px;
      }
    </style>
  </head>
  <body>
    <!-- 1.首先创建一个canvas，设置其宽高 -->
    <h1>截图⽰例</h1>
    <p>这是⼀个简单的截图⽰例。</p>
    <button id="btn">截图</button><canvas id="canvas"></canvas>
    <script>
        /* 2.使用canvasAPI在canvas上绘制需要截图的内容，比如页面的某个区域，某个元素，图片 */
        const canvas = document.querySelector("#canvas");
        const ctx = canvas.getContext('2d');
        const btn = document.getElementById("btn");
        // 适配高清屏并获取完整页面尺寸
        const scale = window.devicePixelRatio || 1;
        canvas.width = document.documentElement.scrollWidth * scale;
        canvas.height = document.documentElement.scrollHeight * scale;
        ctx.scale(scale, scale);
        btn.addEventListener("click",()=>{
            ctx.clearRect(0,0,canvas.width,canvas.height);
            // 使用更可靠的截图方式
            html2canvas(document.body, {
                allowTaint: true,
                useCORS: true,
                scrollX: -window.scrollX,
                scrollY: -window.scrollY
            }).then(canvas => {
              /* 3.调用canvasAPI中的toDataURL()方法将canvas转化为base64编码的图片数据 */
                const imgData = canvas.toDataURL('image/png');
                // 创建下载链接
                const link = document.createElement('a');
                link.download = 'screenshot.png';
                /* 4.将base64编码的图片转化为地址展现在前端页面 */
                link.href = imgData;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }).catch(err => {
                console.error('截图失败:', err);
                alert('截图失败，请重试');
            });
        })
    </script>
  </body>
</html>
