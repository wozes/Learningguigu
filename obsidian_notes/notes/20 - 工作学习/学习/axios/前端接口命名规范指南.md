# å‰ç«¯æ¥å£å‘½åè§„èŒƒæŒ‡å—

æ¥å£åç§°åº”è¯¥å’Œåç«¯å¯¹åº”å—ï¼Ÿ

## ğŸ¤” ä¸¤ç§ä¸»æµè§‚ç‚¹

### è§‚ç‚¹1ï¼šåº”è¯¥å¯¹åº” âœ…

**ä¼˜ç‚¹**ï¼š

- å‰åç«¯æ²Ÿé€šæ›´æ¸…æ™°
- å®šä½é—®é¢˜æ›´å®¹æ˜“
- API æ–‡æ¡£å’Œä»£ç ä¸€è‡´

**ç¼ºç‚¹**ï¼š

- å‰ç«¯å¯èƒ½è¢«åç«¯ API è®¾è®¡ç»‘æ¶
- åç«¯ API å‘½åä¸å¤Ÿè¯­ä¹‰åŒ–æ—¶å‰ç«¯ä¹Ÿè¦è·Ÿç€

### è§‚ç‚¹2ï¼šä¸å¿…å®Œå…¨å¯¹åº” âœ…

**ä¼˜ç‚¹**ï¼š

- å‰ç«¯å¯ä»¥ç”¨æ›´ç¬¦åˆä¸šåŠ¡é€»è¾‘çš„å‘½å
- æ›´å¥½çš„ä»£ç å¯è¯»æ€§
- è§£è€¦å‰åç«¯

**ç¼ºç‚¹**ï¼š

- éœ€è¦ç»´æŠ¤æ˜ å°„å…³ç³»
- æ–°äººç†è§£æˆæœ¬ç¨é«˜

## ğŸ’¡ æ¨èæ–¹æ¡ˆï¼šæ··åˆç­–ç•¥

æ ¹æ®ä¸åŒæƒ…å†µé‡‡ç”¨ä¸åŒç­–ç•¥ï¼š

### 1. URL è·¯å¾„ï¼šå»ºè®®å¯¹åº”

```typescript
// åç«¯ API: GET /api/categories
// å‰ç«¯æ¥å£å‡½æ•°å‘½å
export const categoryApi = {
  getCategories: () => httpClient.get('/api/categories'),
  getCategoryById: (id: number) => httpClient.get(`/api/categories/${id}`),
  createCategory: (data: any) => httpClient.post('/api/categories', data),
  updateCategory: (id: number, data: any) => httpClient.put(`/api/categories/${id}`, data),
  deleteCategory: (id: number) => httpClient.delete(`/api/categories/${id}`)
}
```

### 2. æ•°æ®ç»“æ„ï¼šçœ‹æƒ…å†µ

æ ¹æ®åç«¯ API çš„è´¨é‡å†³å®šï¼š

#### æƒ…å†µAï¼šåç«¯ API è®¾è®¡åˆç†

```typescript
// åç«¯è¿”å›
{
  "code": 200,
  "message": "success",
  "data": {
    "categories": [
      {
        "id": 1,
        "name": "ç”µå­äº§å“",
        "parent_id": null,
        "is_active": true,
        "created_at": "2024-01-01T10:00:00Z"
      }
    ]
  }
}

// å‰ç«¯æ¥å£ï¼šç›´æ¥å¯¹åº”
interface Category {
  id: number;
  name: string;
  parent_id: number | null;
  is_active: boolean;
  created_at: string;
}

interface ApiResponse<T> {
  code: number;
  message: string;
  data: T;
}
```

#### æƒ…å†µBï¼šåç«¯ API è®¾è®¡ä¸ç†æƒ³

```typescript
// åç«¯è¿”å›ï¼ˆå­—æ®µå‘½åä¸è§„èŒƒï¼‰
{
  "code": 200,
  "msg": "ok",
  "result": {
    "cat_list": [
      {
        "cat_id": 1,
        "cat_name": "ç”µå­äº§å“",
        "p_id": null,
        "status": 1,
        "add_time": "2024-01-01 10:00:00"
      }
    ]
  }
}

// å‰ç«¯æ¥å£ï¼šä¸¤ç§å¤„ç†æ–¹å¼

// æ–¹å¼1ï¼šç›´æ¥å¯¹åº”ï¼ˆä¸æ¨èï¼Œä½†ç®€å•ï¼‰
interface BackendCategory {
  cat_id: number;
  cat_name: string;
  p_id: number | null;
  status: number;
  add_time: string;
}

// æ–¹å¼2ï¼šè½¬æ¢æ˜ å°„ï¼ˆæ¨èï¼‰
interface Category {
  id: number;
  name: string;
  parentId: number | null;
  isActive: boolean;
  createdAt: string;
}

// åœ¨ API å±‚åšè½¬æ¢
const categoryApi = {
  getCategories: async (): Promise<Category[]> => {
    const response = await httpClient.get<BackendResponse<BackendCategory[]>>('/api/categories');
    
    // è½¬æ¢æ•°æ®ç»“æ„
    return response.result.cat_list.map(item => ({
      id: item.cat_id,
      name: item.cat_name,
      parentId: item.p_id,
      isActive: item.status === 1,
      createdAt: item.add_time
    }));
  }
}
```

## ğŸ¯ å®é™…é¡¹ç›®å»ºè®®

### 1. å›¢é˜Ÿè§„èŒƒä¼˜å…ˆ

```typescript
// å¦‚æœå›¢é˜Ÿæœ‰ç»Ÿä¸€è§„èŒƒï¼Œä¼˜å…ˆéµå¾ª
// ä¾‹å¦‚ï¼šå›¢é˜Ÿå†³å®šå‰ç«¯å­—æ®µå…¨éƒ¨ç”¨ camelCase
interface User {
  userId: number;      // åç«¯ï¼šuser_id
  userName: string;    // åç«¯ï¼šuser_name
  createdAt: string;   // åç«¯ï¼šcreated_at
}
```

### 2. åˆ†å±‚å¤„ç†

```typescript
// api/types/backend.ts - åç«¯åŸå§‹æ•°æ®ç»“æ„
export interface BackendUser {
  user_id: number;
  user_name: string;
  email: string;
  created_at: string;
}

// types/user.ts - å‰ç«¯ä¸šåŠ¡æ•°æ®ç»“æ„
export interface User {
  id: number;
  name: string;
  email: string;
  createdAt: Date;  // æ³¨æ„ï¼šè½¬æ¢æˆ Date å¯¹è±¡
}

// api/user.ts - API å±‚åšè½¬æ¢
import { BackendUser } from './types/backend';
import { User } from '@/types/user';

export const userApi = {
  getUsers: async (): Promise<User[]> => {
    const response = await httpClient.get<ApiResponse<BackendUser[]>>('/api/users');
    
    return response.data.map(backendUser => ({
      id: backendUser.user_id,
      name: backendUser.user_name,
      email: backendUser.email,
      createdAt: new Date(backendUser.created_at)
    }));
  }
}
```

### 3. å®ç”¨å·¥å…·å‡½æ•°

```typescript
// utils/transform.ts
export class ApiTransformer {
  // ä¸‹åˆ’çº¿è½¬é©¼å³°
  static toCamelCase(obj: any): any {
    if (Array.isArray(obj)) {
      return obj.map(item => this.toCamelCase(item));
    }
    
    if (obj && typeof obj === 'object') {
      const result: any = {};
      for (const key in obj) {
        const camelKey = key.replace(/_([a-z])/g, (_, letter) => letter.toUpperCase());
        result[camelKey] = this.toCamelCase(obj[key]);
      }
      return result;
    }
    
    return obj;
  }
  
  // é©¼å³°è½¬ä¸‹åˆ’çº¿
  static toSnakeCase(obj: any): any {
    if (Array.isArray(obj)) {
      return obj.map(item => this.toSnakeCase(item));
    }
    
    if (obj && typeof obj === 'object') {
      const result: any = {};
      for (const key in obj) {
        const snakeKey = key.replace(/[A-Z]/g, letter => `_${letter.toLowerCase()}`);
        result[snakeKey] = this.toSnakeCase(obj[key]);
      }
      return result;
    }
    
    return obj;
  }
}

// ä½¿ç”¨
const backendData = { user_id: 1, user_name: 'å¼ ä¸‰' };
const frontendData = ApiTransformer.toCamelCase(backendData);
// ç»“æœ: { userId: 1, userName: 'å¼ ä¸‰' }
```

## ğŸ”§ ä½ çš„é¡¹ç›®å»ºè®®

æ ¹æ®ä½ çš„ä»£ç ï¼Œæˆ‘å»ºè®®ï¼š

### 1. å½“å‰æ–¹æ¡ˆï¼ˆç®€å•ç›´æ¥ï¼‰

```typescript
// ç›´æ¥å¯¹åº”åç«¯å­—æ®µ
interface Category {
  id: number;
  name: string;
  parent_id?: number;  // å¯¹åº”åç«¯ parent_id
  level: number;
  sort_order: number;
  is_active: boolean;
  created_at: string;
  updated_at: string;
}

export const categoryApi = {
  getCategories: async (parentId?: number): Promise<Category[]> => {
    const response = await httpClient.get<ApiResponse<{ categories: Category[] }>>(
      '/public/categories',
      { params: { parent_id: parentId } }
    );
    return response.data.categories;
  }
}
```

### 2. æ”¹è¿›æ–¹æ¡ˆï¼ˆæ¨èï¼‰

```typescript
// å‰ç«¯ä¸šåŠ¡æ•°æ®ç»“æ„ï¼ˆæ›´ç¬¦åˆå‰ç«¯å‘½åä¹ æƒ¯ï¼‰
interface Category {
  id: number;
  name: string;
  parentId?: number;     // æ”¹ä¸º camelCase
  level: number;
  sortOrder: number;     // æ”¹ä¸º camelCase
  isActive: boolean;     // æ”¹ä¸º camelCase
  createdAt: string;     // æ”¹ä¸º camelCase
  updatedAt: string;     // æ”¹ä¸º camelCase
  children?: Category[];
}

// åç«¯åŸå§‹æ•°æ®ç»“æ„
interface BackendCategory {
  id: number;
  name: string;
  parent_id?: number;
  level: number;
  sort_order: number;
  is_active: boolean;
  created_at: string;
  updated_at: string;
}

// API å±‚åšè½¬æ¢
export const categoryApi = {
  getCategories: async (parentId?: number): Promise<Category[]> => {
    const response = await httpClient.get<ApiResponse<{ categories: BackendCategory[] }>>(
      '/public/categories',
      { params: { parent_id: parentId } }
    );
    
    return response.data.categories.map(item => ({
      id: item.id,
      name: item.name,
      parentId: item.parent_id,
      level: item.level,
      sortOrder: item.sort_order,
      isActive: item.is_active,
      createdAt: item.created_at,
      updatedAt: item.updated_at
    }));
  }
}
```

## ğŸ“‹ å†³ç­–çŸ©é˜µ

| æƒ…å†µ                          | å»ºè®®         | åŸå›                  |
| ----------------------------- | ------------ | -------------------- |
| åç«¯ API è§„èŒƒï¼Œå­—æ®µå‘½ååˆç†   | ç›´æ¥å¯¹åº”     | ç®€å•ç›´æ¥ï¼Œæ²Ÿé€šæˆæœ¬ä½ |
| åç«¯ API ä¸è§„èŒƒï¼Œå­—æ®µå‘½åæ··ä¹± | è½¬æ¢æ˜ å°„     | æé«˜å‰ç«¯ä»£ç è´¨é‡     |
| å›¢é˜Ÿæœ‰ç»Ÿä¸€è§„èŒƒ                | éµå¾ªå›¢é˜Ÿè§„èŒƒ | ä¿æŒä¸€è‡´æ€§           |
| é¡¹ç›®ç´§æ€¥ï¼Œæ—¶é—´ä¸å¤Ÿ            | ç›´æ¥å¯¹åº”     | å¿«é€Ÿå¼€å‘             |
| é•¿æœŸç»´æŠ¤é¡¹ç›®                  | è½¬æ¢æ˜ å°„     | ä¾¿äºåç»­ç»´æŠ¤         |

## ğŸ’¡ æ€»ç»“

**æˆ‘çš„å»ºè®®**ï¼š

1. **ä¼˜å…ˆéµå¾ªå›¢é˜Ÿè§„èŒƒ**

2. **URL è·¯å¾„å»ºè®®å¯¹åº”åç«¯**

3. æ•°æ®ç»“æ„çœ‹æƒ…å†µ

   ï¼š

   - åç«¯è§„èŒƒ â†’ ç›´æ¥å¯¹åº”
   - åç«¯ä¸è§„èŒƒ â†’ è½¬æ¢æ˜ å°„

4. **é¡¹ç›®åˆæœŸå¯ä»¥ç®€å•å¯¹åº”ï¼ŒåæœŸå†ä¼˜åŒ–**

å¯¹äºä½ çš„é¡¹ç›®ï¼Œå¦‚æœåç«¯ API è®¾è®¡åˆç†ï¼Œå»ºè®®å…ˆç›´æ¥å¯¹åº”ï¼Œé¡¹ç›®ç¨³å®šåå†è€ƒè™‘æ˜¯å¦éœ€è¦è½¬æ¢å±‚ã€‚

ä½ ä»¬å›¢é˜Ÿæœ‰ç›¸å…³è§„èŒƒå—ï¼Ÿè¿˜æ˜¯æˆ‘å¸®ä½ åˆ¶å®šä¸€ä¸ªé€‚åˆçš„æ–¹æ¡ˆï¼Ÿ