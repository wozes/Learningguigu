# Problem: 能不能说一说CSRF攻击？

*[interview]: start

CSRF（Cross-Site Request Forgery，跨站请求伪造）是一种常见的Web安全漏洞，作为前端开发者，了解它非常重要。

## CSRF攻击原理

CSRF攻击利用用户已经登录的状态，诱使用户在不知情的情况下执行非预期的操作。攻击流程通常是：

1. 用户登录了银行网站A，浏览器保存了认证cookie
2. 用户访问了恶意网站B
3. 恶意网站B包含一个指向银行网站A的请求（如转账操作）
4. 由于浏览器会自动携带cookie，银行网站A认为这是用户的合法请求
5. 攻击成功执行

## 常见攻击方式

**GET请求攻击：**
```html
<!-- 恶意网站中的图片标签 -->
<img src="https://bank.com/transfer?to=attacker&amount=1000">
```

**POST请求攻击：**
```html
<!-- 自动提交的表单 -->
<form action="https://bank.com/transfer" method="POST" id="csrf-form">
    <input type="hidden" name="to" value="attacker">
    <input type="hidden" name="amount" value="1000">
</form>
<script>document.getElementById('csrf-form').submit();</script>
```

## 前端防护措施

**1. CSRF Token**
最常用的防护方法，服务器为每个表单生成唯一token：
```html
<form action="/transfer" method="POST">
    <input type="hidden" name="csrf_token" value="abc123xyz">
    <input type="text" name="amount">
    <button type="submit">转账</button>
</form>
```

**2. 验证Referer头**
检查请求来源是否为合法域名，但这种方法不够可靠。

**3. 使用SameSite Cookie**
```javascript
// 设置cookie时添加SameSite属性
document.cookie = "sessionid=abc123; SameSite=Strict";
```

**4. 双重Cookie验证**
将CSRF token同时放在cookie和请求参数中，服务器验证两者是否一致。

**5. 自定义请求头**
对于AJAX请求，添加自定义头部：
```javascript
fetch('/api/transfer', {
    method: 'POST',
    headers: {
        'X-Requested-With': 'XMLHttpRequest',
        'X-CSRF-Token': getCSRFToken()
    },
    body: JSON.stringify(data)
});
```

## 现代框架的处理

大多数现代前端框架都内置了CSRF防护：
- React：可以使用axios等库自动处理CSRF token
- Vue：Vue CLI生成的项目通常配置了CSRF防护
- Angular：HttpClient默认支持CSRF防护

作为前端开发者，你需要确保与后端配合实现这些防护措施，特别是在处理敏感操作时要格外小心。
*[interview]: end
